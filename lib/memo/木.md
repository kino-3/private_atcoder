# 木の解法のメモ

## 最長経路(つまり, 木の直径) O(V)

### 問題

- 辺はコストを持つ
- 最も遠い2点の距離を求める

### 解法

1. 任意の点(X)から最も遠い点(A)を探索(BFSなど)する
2. A から最も遠い点(B)を探索(BFSなど)する

このとき, A-B が最長経路(の1つ)となる。

### 証明

任意の点(X)から最も遠い点がA'(≠A)とする。X を取り除いたとき, AとBが異なる部分木にあるなら, A'-B が A-B より長くなり矛盾。AとBが同じ部分木にあるなら, X で吊ったときのAとBのLCAをYとすると, A-Y よりも Y-X-A' の方が長く, A'-X-Y-B が A-Y-B より長くなり矛盾。

## 全始点最長経路 O(V)

### 問題

- 辺はコストを持つ
- 全ての点について, 自身から最も遠い点の距離を求める

### 解法

- 木の直径の 1 つを s-t とする
- 任意の点 u について, `max_v d(u,v) = max(d(u,s),d(u,t))` と求まる。

### 証明

最も遠い点を w と仮定したとき, u,s,t,w の位置関係で場合分け(省略)すると, 木の直径は d(s,w) または d(t,w) となる。

### 参考問題

- [問題](https://atcoder.jp/contests/abc222/tasks/abc222_f)

## 直径となる点対・点群の個数

### 問題

- 辺はコストを持たない
- 直径を構成する点群の個数

### 解法

- 木の直径の 1 つを s-t とする
- s-t 上に頂点が偶数個あるとき (直径 D = 2d + 1)
  - s-u-v-t (u,vは中央の隣接2点) とする。u-v を切断した時
    - u の部分木で, u を根とした時の深さの最大値は d なので, u の部分木の直径は 2d
    - よって, 直径は必ず u-v を通る。
    - すなわち, 3 点以上が互いに直径となることはない。
- s-t 上に頂点が奇数個あるとき (直径 D = 2d)
  - s-u-t (uは中央の点) とする。
    - 同様に, 直径は必ず u を通る。
    - すなわち, u を取り除いた時の各部分木から高々 1 つ頂点を選ぶ

### 参考問題

- [問題](https://atcoder.jp/contests/abc221/tasks/abc221_f)
