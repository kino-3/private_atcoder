# 証明

## 線形計画問題との対応関係

> x(j) - x(i) <= w(i, j) の形式の制約条件がある。
> i -> j が w(i, j) の重みを持つグラフ G を考えたとき,
>
> 1. G が負の閉路を持つならば, 制約条件を満たす解は存在しない。
> 2. G が負の閉路を持たず, i -> k が到達可能ならば, 制約条件を満たす解は存在して x(k) - x(i) の最大値は i から k への最短距離に等しい
> 3. G が負の閉路を持たず, i -> k が到達不可能ならば, 制約条件を満たす解は存在して x(k) - x(i) は無限に大きくできる。
> 4. 1, 2, 3 は逆も成り立つ。

### 1 の証明

負の閉路上で `x(j) - x(i) <= w(i, j)` を全て足し合わせると, 左辺は 0 となり, 右辺は負の閉路の総和となるから `0 <= 負` となり矛盾するから, これらのうち 1 つ以上の制約条件は成り立たない。
(逆の証明: 負の閉路を持たないならば, bellman ford より任意の始点 s から i の最短距離 dist(i) が存在して, 全ての w(i,j) について `dist(j) <= w(i, j) + dist(i)` より解 `x(i) = dist(i)` が存在する。(到達不可能な点 i がある場合は, s -> i に十分大きなコストの辺を追加したグラフ G' を考えると, G' は負の閉路を持たず, dist(i) を定義できて, `x(i) = dist(i)` は全ての制約条件を満たす。))

### 2 の証明

命題1 の逆の対偶より, G が負の閉路を持たないならば, 制約条件を満たす解は存在する。  
G が負の閉路を持たず i -> k が到達可能ならば, bellman ford より始点 i から u の最短距離 dist(u) が存在して, 制約条件を全て満たす解 `x(u) = dist(u)` が存在する。この解において, `x(k) - x(i) = dist(k) - dist(i) = dist(k)` より, 「`x(k) - x(i)` は i から k への最短距離をとりうる」ことが分かる。  
また, i -> k の最短経路に沿って `x(j) - x(i) <= w(i, j)` を足し合わせると, `x(k) - x(i) <= 最短経路のコスト` となる。  
したがって, `x(k) - x(i) <= 最短経路のコスト` かつ等号が成立する解 `x(u) = dist(u)` が存在することから, 「x(k) - x(i) の最大値は i から k への最短距離に等しい」

### 3 の証明

G が負の閉路を持たず, i -> k が到達不可能なとき, i -> k にコスト W (W は十分大きな任意の正の値) の辺を追加したグラフ G' を考える。  
G' は負の閉路を持たず, i -> k が到達可能なので, 命題2 より 制約条件' を満たす解は存在して x(k) - x(i) の最大値は i から k への最短距離 W に等しい。よって, 「元の制約条件 かつ `x(k) - x(i) <= W`」を満たすとき, x(k) - x(i) は W を取ることができるから, x(k) - x(i) は (元の)制約条件 を満たしつつ無限に大きくできる。

### 4 の証明

1, 2, 3 より明らか。
(例えば, 「制約条件を満たす解は存在して x(j) - x(i) の最大値は i から j への最短距離に等しい」とき, 「G が負の閉路を持たず, i -> j が到達可能」ではないと仮定すると, 「G が負の閉路を持つ」または「G が負の閉路を持たず, i -> j が到達不可能」となり, 1, 2 より「制約条件を満たす解は存在しない」または「制約条件を満たす解は存在して x(j) - x(i) は無限に大きくできる」となり「制約条件を満たす解は存在して x(j) - x(i) の最大値は i から j への最短距離に等しい」ことと矛盾する。)

## ポテンシャルの話

参考: https://niuez.hatenablog.com/entry/2019/03/04/142903

- i -> j の重みが w(i, j) のグラフ G における u から全ての v の最短距離 p(v) を求める。

このとき, `p(j) <= p(i) + w(i, j)` すなわち, `p(i) - p(j) + w(i, j) >= 0` がなりたつ。

- i -> j の重みが `p(i) - p(j) + w(i, j)` のグラフ G' を考える。(このグラフの辺の重みは全て正)
- G' における s から全ての t の最短距離 q(t) を求める。

このとき, `q(j) <= q(i) + p(i) - p(j) + w(i, j)` すなわち `q(j) + p(j) - p(s) <= q(i) + p(i) - p(s) + w(i, j)` が成り立つ。  
また, `q(s) = 0` より, i = s のとき, `q(i) + p(i) - p(s) = 0` となる。

- G における s から t の最短距離は `q(t) + p(t) - p(s)` である。

### ポテンシャル2

- i -> j の重みが w(i, j) のグラフ G における source から全ての v の最短距離 p(v) を求める。

このとき, `p(j) <= p(i) + w(i, j)` すなわち, `p(i) - p(j) + w(i, j) >= 0` がなりたつ。  
また, 最短距離の経路上で `p(i) - p(j) + w(i, j) = 0` がなりたつ。

- i -> j の重みが `w'(i, j) = p(i) - p(j) + w(i, j)` のグラフ G' を考える。(このグラフの辺の重みは全て正)

`w*(i, j) >= 0` を保つように `w'` を `w*` に書き換えたグラフ G* を考える。

- G* における source から全ての t の最短距離 q(t) を求める。
